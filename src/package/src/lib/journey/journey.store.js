import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js";import e from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/redirect-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/select-idp-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/suspended-text-output-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-input-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js";import{StepType as s}from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js";import o from"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js";import"../../../node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js";import{writable as r}from"../../../node_modules/svelte/store/index.js";import{htmlDecode as a}from"./_utilities/decode.utilities.js";import{interpolate as l}from"../_utilities/i18n.utilities.js";import{shouldPopulateWithPreviousCallbacks as t,authIdTimeoutErrorCode as c}from"./_utilities/step.utilities.js";function i(i){const{set:d,subscribe:m}=r({completed:!1,error:null,loading:!1,step:null,successful:!1,response:null});let n=0;async function p(r=null,m,p){const u={...i,...m};let k;r&&r.type===s.Step&&(k=r?.callbacks);const f=r?.payload;let b;d({completed:!1,error:null,loading:!0,step:r,successful:!1,response:null});try{p?(u.tree=void 0,b=await e.resume(p,u)):r?(u.tree=void 0,b=await e.next(r,u)):b=await e.next(void 0,u)}catch(e){console.error(`Next step request | ${e}`),b=new o({message:l("unknownNetworkError")})}if(b.type===s.Step)n+=1,d({completed:!1,error:null,loading:!1,step:b,successful:!1,response:null});else if(b.type===s.LoginSuccess)d({completed:!0,error:null,loading:!1,step:null,successful:!0,response:b.payload});else if(b.type===s.LoginFailure){const i=a(b.payload.message||"");let m=null;try{m=await e.next(void 0,u)}catch(e){console.error(`Restart failed step request | ${e}`),m=new o({message:l("unknownNetworkError")})}if(t(b,k,m,n)){m.callbacks=k,m.payload={...f,authId:m.payload.authId};b.payload.detail?.errorCode===c&&(m=await e.next(m,u))}m.type===s.Step?d({completed:!1,error:{code:b.getCode(),message:i,step:r?.payload},loading:!1,step:m,successful:!1,response:null}):m.type===s.LoginSuccess?d({completed:!0,error:null,loading:!1,step:null,successful:!0,response:m.payload}):d({completed:!0,error:{code:b.getCode(),message:i,step:r?.payload},loading:!1,step:null,successful:!1,response:m.payload})}}return{next:p,reset:function(){d({completed:!1,error:null,loading:!1,step:null,successful:!1,response:null})},resume:async function(e,s){await p(void 0,s,e)},start:async function(e){await p(void 0,e)},subscribe:m}}export{i as initialize};