import{get_store_value as s,SvelteComponent as e,init as o,safe_not_equal as r,binding_callbacks as a,bind as t,element as i,create_component as l,attr as c,insert as n,mount_component as d,add_flush_callback as m,transition_in as u,transition_out as p,detach as k,destroy_component as f,createEventDispatcher as j,onMount as b}from"./node_modules/svelte/internal/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/auth/enums.js";import g from"./node_modules/@forgerock/javascript-sdk/lib-esm/config/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/event/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/attribute-input-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/choice-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/confirmation-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/device-profile-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/hidden-value-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/kba-create-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/metadata-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/name-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/polling-wait-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/recaptcha-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/redirect-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/select-idp-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/suspended-text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/terms-and-conditions-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-input-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/text-output-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-password-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/callbacks/validated-create-username-callback.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/enums.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-failure.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-login-success.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-auth/fr-step.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-device/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-policy/message-creator.js";import h from"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-user/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/fr-webauthn/index.js";import v from"./node_modules/@forgerock/javascript-sdk/lib-esm/http-client/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/oauth2-client/index.js";import _ from"./node_modules/@forgerock/javascript-sdk/lib-esm/session-manager/index.js";import y from"./node_modules/@forgerock/javascript-sdk/lib-esm/token-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/token-storage/index.js";import x from"./node_modules/@forgerock/javascript-sdk/lib-esm/user-manager/index.js";import"./node_modules/@forgerock/javascript-sdk/lib-esm/util/pkce.js";import $ from"./src/lib/components/compositions/dialog/dialog.js";import w from"./src/lib/journey/journey.js";import z from"./src/lib/config.js";import{initialize as E}from"./src/lib/journey/journey.store.js";import{initialize as C}from"./src/lib/locale.store.js";import{initialize as I}from"./src/lib/links.store.js";import{initialize as U}from"./src/lib/oauth/oauth.store.js";import{initialize as M}from"./src/lib/user/user.store.js";import{initialize as T}from"./src/lib/style.store.js";function D(s){let e,o,r;function i(e){s[9](e)}let c={displayIcon:s[0]?.stage?.icon??!s[0]?.logo,journeyStore:s[5]};return void 0!==s[3]&&(c.formEl=s[3]),e=new w({props:c}),a.push((()=>t(e,"formEl",i))),{c(){l(e.$$.fragment)},m(s,o){d(e,s,o),r=!0},p(s,r){const a={};1&r&&(a.displayIcon=s[0]?.stage?.icon??!s[0]?.logo),!o&&8&r&&(o=!0,a.formEl=s[3],m((()=>o=!1))),e.$set(a)},i(s){r||(u(e.$$.fragment,s),r=!0)},o(s){p(e.$$.fragment,s),r=!1},d(s){f(e,s)}}}function L(s){let e,o,r,j;function b(e){s[10](e)}let g={closeCallback:s[4],dialogId:"sampleDialog",$$slots:{default:[D]},$$scope:{ctx:s}};return void 0!==s[2]&&(g.dialogEl=s[2]),o=new $({props:g}),a.push((()=>t(o,"dialogEl",b))),s[11](o),{c(){e=i("div"),l(o.$$.fragment),c(e,"class","fr_widget-root")},m(s,r){n(s,e,r),d(o,e,null),j=!0},p(s,[e]){const a={};32777&e&&(a.$$scope={dirty:e,ctx:s}),!r&&4&e&&(r=!0,a.dialogEl=s[2],m((()=>r=!1))),o.$set(a)},i(s){j||(u(o.$$.fragment,s),j=!0)},o(s){p(o.$$.fragment,s),j=!1},d(r){r&&k(e),s[11](null),f(o)}}}let S,W,q,F,P,R,A,B,G;const H={start(s){const e=s?.oauth||!0,o=s?.user||!0;let r,a,t=P.subscribe((s=>{!e&&s.successful?(B&&B({journey:s}),J.close({reason:"auto"})):e&&s.successful?(r=s,R.get({forceRenew:!0})):s.error&&(r=s,A&&A({journey:s})),s.successful&&t()})),i=R.subscribe((s=>{!o&&s.successful?(B&&B({journey:r,oauth:s}),J.close({reason:"auto"})):o&&s.successful?(a=s,G.get()):s.error&&(a=s,A&&A({journey:r,oauth:s})),s.successful&&i()})),l=G.subscribe((s=>{s.successful?(B&&B({journey:r,oauth:a,user:s}),J.close({reason:"auto"})):s.error&&A&&A({journey:r,oauth:a,user:s}),s.successful&&l()}));s?.resumeUrl?P.resume(s.resumeUrl):P.start({...s?.config,tree:s?.journey})},onFailure(s){A=e=>s(e)},onSuccess(s){B=e=>s(e)}},J={close(s){S.closeDialog(s)},onClose(s){F=e=>s(e)},onMount(s){q=(e,o)=>s(e,o)},open(e){s(P).step||H.start(e),W.showModal()}},K=async s=>await v.request(s),N={authorized:async(s=!1)=>s?!!await x.getCurrentUser():!!await y.getTokens(),info:async(e=!1)=>e?await x.getCurrentUser():s(G).response,async logout(){const{clientId:s}=g.get();s?await h.logout():await _.logout(),P.reset(),R.reset(),G.reset(),H.start()},tokens:async s=>await y.getTokens(s)};function O(s,e,o){let{config:r}=e,{content:t}=e,{links:i}=e,{style:l}=e;const c=j();let n,d,m,u=F;z({clientId:"WebLoginWidgetClient",realmPath:"alpha",redirectUri:"object"==typeof window?window.location.href:"https://localhost:3000/callback",scope:"openid email",tree:"Login",...r,support:"legacy"});let p=P=E(r);return R=U(r),G=M(r),C(t),I(i),T(l),b((()=>{S=n,W=d,q&&q(d,m),setTimeout((()=>{c("modal-mount","Modal mounted")}),0)})),s.$$set=s=>{"config"in s&&o(6,r=s.config),"content"in s&&o(7,t=s.content),"links"in s&&o(8,i=s.links),"style"in s&&o(0,l=s.style)},[l,n,d,m,u,p,r,t,i,function(s){m=s,o(3,m)},function(s){d=s,o(2,d)},function(s){a[s?"unshift":"push"]((()=>{n=s,o(1,n)}))}]}class Q extends e{constructor(s){super(),o(this,s,O,L,r,{config:6,content:7,links:8,style:0})}}export{Q as default,H as journey,J as modal,K as request,N as user};