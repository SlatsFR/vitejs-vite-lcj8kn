import"../../cssfilter/lib/index.js";import"./default.js";import"./parser.js";import t from"./util.js";import{__exports as r}from"../../../_virtual/default.js";import{__exports as o}from"../../../_virtual/parser.js";import{l as e}from"../../../_virtual/index2.js";var n=e.exports.FilterCSS,s=r,i=o,a=i.parseTag,g=i.parseAttr,l=t;function p(t){return null==t}function u(t){(t=function(t){var r={};for(var o in t)r[o]=t[o];return r}(t||{})).stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=s.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=function(t){var r={};for(var o in t)Array.isArray(t[o])?r[o.toLowerCase()]=t[o].map((function(t){return t.toLowerCase()})):r[o.toLowerCase()]=t[o];return r}(t.whiteList||t.allowList):t.whiteList=s.whiteList,t.onTag=t.onTag||s.onTag,t.onTagAttr=t.onTagAttr||s.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||s.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||s.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||s.safeAttrValue,t.escapeHtml=t.escapeHtml||s.escapeHtml,this.options=t,!1===t.css?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new n(t.css))}u.prototype.process=function(t){if(!(t=(t=t||"").toString()))return"";var r=this.options,o=r.whiteList,e=r.onTag,n=r.onIgnoreTag,i=r.onTagAttr,u=r.onIgnoreTagAttr,c=r.safeAttrValue,f=r.escapeHtml,T=this.cssFilter;r.stripBlankChar&&(t=s.stripBlankChar(t)),r.allowCommentTag||(t=s.stripCommentTag(t));var m=!1;r.stripIgnoreTagBody&&(m=s.StripTagBody(r.stripIgnoreTagBody,n),n=m.onIgnoreTag);var h=a(t,(function(t,r,s,a,m){var h={sourcePosition:t,position:r,isClosing:m,isWhite:Object.prototype.hasOwnProperty.call(o,s)},v=e(s,a,h);if(!p(v))return v;if(h.isWhite){if(h.isClosing)return"</"+s+">";var I=function(t){var r=l.spaceIndex(t);if(-1===r)return{html:"",closing:"/"===t[t.length-2]};var o="/"===(t=l.trim(t.slice(r+1,-1)))[t.length-1];return o&&(t=l.trim(t.slice(0,-1))),{html:t,closing:o}}(a),A=o[s],w=g(I.html,(function(t,r){var o=-1!==l.indexOf(A,t),e=i(s,t,r,o);return p(e)?o?(r=c(s,t,r,T))?t+'="'+r+'"':t:p(e=u(s,t,r,o))?void 0:e:e}));return a="<"+s,w&&(a+=" "+w),I.closing&&(a+=" /"),a+=">"}return p(v=n(s,a,h))?f(a):v}),f);return m&&(h=m.remove(h)),h};var c=u;export{c as default};